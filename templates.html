<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="js/jquery-2.2.4.min.js"></script>
    <script src="js/handlebars-4.0.5.min.js"></script>
  </head>
  <body>

    <script type="text/x-handlebars-template" id="template_navbar">
      <!-- Orgs and categories -->
      <div id="navigation">
        <div class="home-label nav-label">
            &#9660;&nbsp;Voyager
        </div>
        <div id="orgs_label" class="nav-label">
          <span style="padding-right: 4px">{{strings.orgs}}</span>
          <span>
            <svg width="16" height="16" id="orgs_downarrow">
              <polyline points="4,10 8,14 12,10" stroke-width="2" stroke="#777" stroke-linecap="round" fill="none"/>
            </svg>
            <svg width="16" height="16" id="orgs_uparrow">
              <polyline points="4,14 8,10 12,14" stroke-width="2" stroke="#777" stroke-linecap="round" fill="none"/>
            </svg>
          </span>
        </div>
        <div id="categories_label" class="nav-label">
          <span style="pading-right: 4px">{{strings.categories}}</span>
          <span>
            <svg width="16" height="16" id="categories_downarrow">
              <polyline points="4,10 8,14 12,10" stroke-width="2" stroke="#777" stroke-linecap="round" fill="none"/>
            </svg>
            <svg width="16" height="16" id="categories_uparrow">
              <polyline points="4,14 8,10 12,14" stroke-width="2" stroke="#777" stroke-linecap="round" fill="none"/>
            </svg>
          </span>
        </div>
      </div>

      <!-- Languages -->
      <div id="languages">
        <div id="lang_ar" {{#if_eq lang 'ar'}}class="active_lang"{{/if_eq}}>
          العربية
        </div>
        <div id="lang_de" {{#if_eq lang 'de'}}class="active_lang"{{/if_eq}}>
          Deutsche
        </div>
        <div id="lang_en" {{#if_eq lang 'en'}}class="active_lang"{{/if_eq}}>
          English
        </div>
      </div>

      <!-- clear navigation and languages float -->
      <div style="clear:both"></div>

      <!-- Organizations -->
      <div id="orgs_menu" class="nav-menu">
        {{#each orgs}}
        <div id="org_{{this.name}}" class="org">
          <img src="{{this.image}}">
          {{lookup this.title ../lang}}
        </div>
        {{/each}}
      </div>

      <!-- Categories -->
      <div id="categories_menu" class="nav-menu">
        {{#each categories}}
        <div id="category_{{this.name}}" class="category">
          <img src="{{this.image}}">
          {{lookup this.title ../lang}}
        </div>
        {{/each}}
      </div>
    </script>

    <script type="text/x-handlebars-template" id="template_main">
      <div id="main_navbar"></div>
      <div id="main_content">
        <h1>{{lookup category.title lang}}</h1>
        <div id="cards-container">
          {{#each content}}
          <div class="card">
            {{#if_eq this.type "video"}}
            <img class="yt-video-image load-image" id="display-{{this.youtube_id}}" data-src="http://img.youtube.com/vi/{{this.youtube_id}}/0.jpg" src="img/placeholder.png"/>
            {{/if_eq}}
            <div class="metadata">
              <div class="logo-container">
                <img class="logo load-image" id="logo-{{this.youtube_id}}" data-src="{{this.logo}}"/>
              </div>
              <div class="author-title-container">
                <div class="author">{{this.author}}</div>
                <div class="title">
                  <a href="{{this.url}}" target="_blank">
                    {{lookup this.title ../lang}}
                  </a>
                </div>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </script>

    <script>
      Handlebars.registerHelper('if_eq', function(a, b, opts) {
          if(a == b) // Or === depending on your needs
              return opts.fn(this);
          else
              return opts.inverse(this);
      });

      // Precompile all templates
      var templates = {};
      $("script[type='text/x-handlebars-template']").each(function(i, e) {
          var source = $(e).html();
          var name = $(e).attr("id");
          templates[name] = Handlebars.compile(source);
      });

      // Message event handler
      window.addEventListener("message", function(event) {
          var command = event.data.command;
          var template = templates[event.data.templateName];

          if (!template) {
              event.source.postMessage({"error": "Unrecognized template"}, event.origin);
          } else {
              switch(command) {
                  case "render":
                      event.source.postMessage({
                          "result": template(event.data.context),
                          "templateName": event.data.templateName
                      }, event.origin);
                      break;
              }
          }
      });
    </script>
  </body>
</html>
